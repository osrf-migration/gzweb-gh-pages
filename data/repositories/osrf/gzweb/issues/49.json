{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/gzweb.json"}, "html": {"href": "#!/osrf/gzweb"}, "avatar": {"href": "data/bytebucket.org/ravatar/{3e2fc3f2-dc25-453b-9792-943c743d9b40}ts=1609263"}}, "type": "repository", "name": "gzweb", "full_name": "osrf/gzweb", "uuid": "{3e2fc3f2-dc25-453b-9792-943c743d9b40}"}, "links": {"attachments": {"href": "data/repositories/osrf/gzweb/issues/49/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/gzweb/issues/49.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gzweb/issues/49/watch"}, "comments": {"href": "data/repositories/osrf/gzweb/issues/49/comments_page=1.json"}, "html": {"href": "#!/osrf/gzweb/issues/49/bug-flawed-comparisons-in-gzguijs-setlight"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gzweb/issues/49/vote"}}, "reporter": {"display_name": "Luc Guyot", "uuid": "{10bf39a6-3a1b-4c7f-9702-fe864c3e8066}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B10bf39a6-3a1b-4c7f-9702-fe864c3e8066%7D"}, "html": {"href": "https://bitbucket.org/%7B10bf39a6-3a1b-4c7f-9702-fe864c3e8066%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:baecfd3c-7ba6-47b5-8711-417af281b471/ed635f95-3d51-407b-b3c0-b20f3d58328a/128"}}, "nickname": "luc_guyot_", "type": "user", "account_id": "557058:baecfd3c-7ba6-47b5-8711-417af281b471"}, "title": "Bug: flawed comparisons in gzgui.js (setLight event)", "component": null, "votes": 0, "watches": 4, "content": {"raw": "In the following excerpt:\r\n```\r\nguiEvents.on('setLight', function (prop, name, value)\r\n      {\r\n        if (value === undefined)\r\n        {\r\n          return;\r\n        }\r\n\r\n        var entity = that.scene.getByName(name);\r\n        if (prop === 'diffuse')\r\n        {\r\n          entity.children[0].color = new THREE.Color(value);\r\n        }\r\n        else if (prop === 'specular')\r\n        {\r\n          entity.serverProperties.specular = new THREE.Color(value);\r\n        }\r\n        else if (prop === 'range')\r\n        {\r\n          entity.children[0].distance = value;\r\n        }\r\n        else if (prop === 'attenuation_constant')\r\n        {\r\n          // Adjust according to factor\r\n          var factor = 1;\r\n          if (entity instanceof THREE.PointLight)\r\n          {\r\n            factor = 1.5;\r\n          }\r\n          else if (entity instanceof THREE.SpotLight)\r\n          {\r\n            factor = 5;\r\n          }\r\n          value *= factor;\r\n\r\n          entity.children[0].intensity = value;\r\n        }\r\n        else if (prop === 'attenuation_linear')\r\n        {\r\n          entity.serverProperties.attenuation_linear = value;\r\n        }\r\n        else if (prop === 'attenuation_quadratic')\r\n        {\r\n          entity.serverProperties.attenuation_quadratic = value;\r\n        }\r\n\r\n        // updating color too often, maybe only update when popup is closed\r\n        that.scene.emitter.emit('entityChanged', entity);\r\n      }\r\n  );\r\n``` \r\n\r\nyou can observe that entity is compared twice against an instance of aTHREE.js light whereas it is an array containing two THREE.js objects.\r\n\r\nPossible fix: use the following variable everywhere possible.\r\n```\r\nvar lightObj = entity.children[0];\r\n```", "markup": "markdown", "html": "<p>In the following excerpt:</p>\n<div class=\"codehilite\"><pre><span></span>guiEvents.on(&#39;setLight&#39;, function (prop, name, value)\n      {\n        if (value === undefined)\n        {\n          return;\n        }\n\n        var entity = that.scene.getByName(name);\n        if (prop === &#39;diffuse&#39;)\n        {\n          entity.children[0].color = new THREE.Color(value);\n        }\n        else if (prop === &#39;specular&#39;)\n        {\n          entity.serverProperties.specular = new THREE.Color(value);\n        }\n        else if (prop === &#39;range&#39;)\n        {\n          entity.children[0].distance = value;\n        }\n        else if (prop === &#39;attenuation_constant&#39;)\n        {\n          // Adjust according to factor\n          var factor = 1;\n          if (entity instanceof THREE.PointLight)\n          {\n            factor = 1.5;\n          }\n          else if (entity instanceof THREE.SpotLight)\n          {\n            factor = 5;\n          }\n          value *= factor;\n\n          entity.children[0].intensity = value;\n        }\n        else if (prop === &#39;attenuation_linear&#39;)\n        {\n          entity.serverProperties.attenuation_linear = value;\n        }\n        else if (prop === &#39;attenuation_quadratic&#39;)\n        {\n          entity.serverProperties.attenuation_quadratic = value;\n        }\n\n        // updating color too often, maybe only update when popup is closed\n        that.scene.emitter.emit(&#39;entityChanged&#39;, entity);\n      }\n  );\n</pre></div>\n\n\n<p>you can observe that entity is compared twice against an instance of aTHREE.js light whereas it is an array containing two THREE.js objects.</p>\n<p>Possible fix: use the following variable everywhere possible.</p>\n<div class=\"codehilite\"><pre><span></span>var lightObj = entity.children[0];\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2014-12-10T14:48:39.665228+00:00", "milestone": null, "updated_on": "2014-12-11T02:07:31.861445+00:00", "type": "issue", "id": 49}