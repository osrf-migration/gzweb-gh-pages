{"links": {"self": {"href": "data/repositories/osrf/gzweb/pullrequests/114/comments/46865920.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gzweb/diff/mohamd_ayman/gzweb:83147cfa246b..54b28e5e49a2?path=gz3d%2Ftest%2Fgzgui_test.js"}, "html": {"href": "#!/osrf/gzweb/pull-requests/114/_/diff#comment-46865920"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 114, "links": {"self": {"href": "data/repositories/osrf/gzweb/pullrequests/114.json"}, "html": {"href": "#!/osrf/gzweb/pull-requests/114"}}, "title": "Test gzGui"}, "content": {"raw": "I debugged this a little bit by adding some print statements to the gzgui constructor and to the toggle receiver:\n\n~~~\ndiff -r 9e4d45b7bbcd gz3d/build/gz3d.js\n--- a/gz3d/build/gz3d.js\tWed Oct 11 07:42:57 2017 +0800\n+++ b/gz3d/build/gz3d.js\tTue Oct 10 17:00:50 2017 -0700\n@@ -870,6 +870,7 @@\n   this.init();\n   this.emitter = new EventEmitter2({verbose: true});\n   this.guiEvents = guiEvents;\n+  console.log('GUI!');\n };\n \n /**\n@@ -1081,6 +1082,7 @@\n \n   guiEvents.on('toggle_notifications', function ()\n       {\n+        console.log('toggle');\n         this.showNotifications = !this.showNotifications;\n         if(!this.showNotifications)\n         {\ndiff -r 9e4d45b7bbcd gz3d/test/gzGui_test.js\n--- a/gz3d/test/gzGui_test.js\tWed Oct 11 07:42:57 2017 +0800\n+++ b/gz3d/test/gzGui_test.js\tTue Oct 10 17:00:50 2017 -0700\n@@ -57,7 +57,9 @@\n           // expect(gui.openTreeWhenSelected).toEqual(true);\n \n           expect(gui.showNotifications).toEqual(false);\n+          console.log('toggle test');\n           guiEvents.emit('toggle_notifications');\n+          console.log('/toggle test');\n           // Why does it fail at this?\n           // @gzgui line: 1034.\n           // expect(gui.showNotifications).toEqual(false);\n~~~\n\nAnd on the output, it looks like there are 2 instances of gzgui being created, and they both receive the toggle event:\n\n~~~\nhrome 57.0.2987 (Linux 0.0.0) LOG: 'GUI!'\n\nChrome 57.0.2987 (Linux 0.0.0) LOG: 'THREE.WebGLRenderer', '86'\n\nChrome 57.0.2987 (Linux 0.0.0) LOG: 'GUI!'\n\nLOG: 'toggle test'\nLOG: 'toggle'\nLOG: 'toggle'\nLOG: '/toggle test'\n~~~\n\nThe first one might be coming from the fixture? Maybe just in case we should create a new one every time on `beforeEach`?\n\nNot sure if this could be related to the problem.", "markup": "markdown", "html": "<p>I debugged this a little bit by adding some print statements to the gzgui constructor and to the toggle receiver:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 9e4d45b7bbcd gz3d/build/gz3d.js</span>\n<span class=\"gd\">--- a/gz3d/build/gz3d.js    Wed Oct 11 07:42:57 2017 +0800</span>\n<span class=\"gi\">+++ b/gz3d/build/gz3d.js    Tue Oct 10 17:00:50 2017 -0700</span>\n<span class=\"gu\">@@ -870,6 +870,7 @@</span>\n   this.init();\n   this.emitter = new EventEmitter2({verbose: true});\n   this.guiEvents = guiEvents;\n<span class=\"gi\">+  console.log(&#39;GUI!&#39;);</span>\n };\n\n /**\n<span class=\"gu\">@@ -1081,6 +1082,7 @@</span>\n\n   guiEvents.on(&#39;toggle_notifications&#39;, function ()\n       {\n<span class=\"gi\">+        console.log(&#39;toggle&#39;);</span>\n         this.showNotifications = !this.showNotifications;\n         if(!this.showNotifications)\n         {\n<span class=\"gh\">diff -r 9e4d45b7bbcd gz3d/test/gzGui_test.js</span>\n<span class=\"gd\">--- a/gz3d/test/gzGui_test.js   Wed Oct 11 07:42:57 2017 +0800</span>\n<span class=\"gi\">+++ b/gz3d/test/gzGui_test.js   Tue Oct 10 17:00:50 2017 -0700</span>\n<span class=\"gu\">@@ -57,7 +57,9 @@</span>\n           // expect(gui.openTreeWhenSelected).toEqual(true);\n\n           expect(gui.showNotifications).toEqual(false);\n<span class=\"gi\">+          console.log(&#39;toggle test&#39;);</span>\n           guiEvents.emit(&#39;toggle_notifications&#39;);\n<span class=\"gi\">+          console.log(&#39;/toggle test&#39;);</span>\n           // Why does it fail at this?\n           // @gzgui line: 1034.\n           // expect(gui.showNotifications).toEqual(false);\n</pre></div>\n\n\n<p>And on the output, it looks like there are 2 instances of gzgui being created, and they both receive the toggle event:</p>\n<div class=\"codehilite\"><pre><span></span>hrome 57.0.2987 (Linux 0.0.0) LOG: &#39;GUI!&#39;\n\nChrome 57.0.2987 (Linux 0.0.0) LOG: &#39;THREE.WebGLRenderer&#39;, &#39;86&#39;\n\nChrome 57.0.2987 (Linux 0.0.0) LOG: &#39;GUI!&#39;\n\nLOG: &#39;toggle test&#39;\nLOG: &#39;toggle&#39;\nLOG: &#39;toggle&#39;\nLOG: &#39;/toggle test&#39;\n</pre></div>\n\n\n<p>The first one might be coming from the fixture? Maybe just in case we should create a new one every time on <code>beforeEach</code>?</p>\n<p>Not sure if this could be related to the problem.</p>", "type": "rendered"}, "created_on": "2017-10-11T00:04:42.859213+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "inline": {"to": 63, "from": null, "outdated": true, "path": "gz3d/test/gzgui_test.js"}, "updated_on": "2017-10-11T00:04:42.864081+00:00", "type": "pullrequest_comment", "id": 46865920}