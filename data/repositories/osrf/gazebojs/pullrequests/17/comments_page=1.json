{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/20976201.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:c8174b0b123a..66cfc2ba268f?path=index.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-20976201"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "You should use the toJson variable here, this would avoid to recompute it each time a new message comes in. \nIf there's a reason not to use it, then it looks like it should be removed.", "markup": "markdown", "html": "<p>You should use the toJson variable here, this would avoid to recompute it each time a new message comes in. \nIf there's a reason not to use it, then it looks like it should be removed.</p>", "type": "rendered"}, "created_on": "2016-07-13T18:37:11.047679+00:00", "user": {"display_name": "Hugo Boyer", "uuid": "{3d87874e-7099-4981-b04f-57f0272faa7d}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D"}, "html": {"href": "https://bitbucket.org/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/21198da8539b599e3633017f5f5f8150d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsHB-6.png"}}, "nickname": "hugomatic", "type": "user", "account_id": "557058:869c02bb-b246-4cdc-9db3-0064e8add185"}, "inline": {"to": 162, "from": null, "path": "index.js"}, "updated_on": "2016-07-13T18:37:11.052987+00:00", "type": "pullrequest_comment", "id": 20976201}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288387.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:183348bc5050..e69da0c806b8?path=test%2Ftest_subscribe.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288387"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "\"toJson\"", "markup": "markdown", "html": "<p>\"toJson\"</p>", "type": "rendered"}, "created_on": "2016-07-20T22:00:16.901208+00:00", "user": {"display_name": "Hugo Boyer", "uuid": "{3d87874e-7099-4981-b04f-57f0272faa7d}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D"}, "html": {"href": "https://bitbucket.org/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/21198da8539b599e3633017f5f5f8150d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsHB-6.png"}}, "nickname": "hugomatic", "type": "user", "account_id": "557058:869c02bb-b246-4cdc-9db3-0064e8add185"}, "inline": {"to": 29, "from": null, "path": "test/test_subscribe.js"}, "updated_on": "2016-07-20T22:00:16.906335+00:00", "type": "pullrequest_comment", "id": 21288387}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288926.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:None..None?path=test%2Ftest_subscribe.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288926"}}, "parent": {"id": 21288387, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288387.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288387"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "okay.", "markup": "markdown", "html": "<p>okay.</p>", "type": "rendered"}, "created_on": "2016-07-20T22:20:01.550245+00:00", "user": {"display_name": "Mohamd Ayman", "uuid": "{72e87935-5983-4f36-8505-0c88a6493930}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B72e87935-5983-4f36-8505-0c88a6493930%7D"}, "html": {"href": "https://bitbucket.org/%7B72e87935-5983-4f36-8505-0c88a6493930%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7/d5d765e0-f86b-4c0d-93ed-c67429f1f465/128"}}, "nickname": "Mohamd Ayman", "type": "user", "account_id": "557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7"}, "inline": {"to": null, "from": null, "path": "test/test_subscribe.js"}, "updated_on": "2016-07-20T22:20:01.588711+00:00", "type": "pullrequest_comment", "id": 21288926}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288450.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:183348bc5050..e69da0c806b8?path=index.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288450"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "there is no return after this callback... control will continue at line 172 and callback will be called again with JSON", "markup": "markdown", "html": "<p>there is no return after this callback... control will continue at line 172 and callback will be called again with JSON</p>", "type": "rendered"}, "created_on": "2016-07-20T22:02:15.576250+00:00", "user": {"display_name": "Hugo Boyer", "uuid": "{3d87874e-7099-4981-b04f-57f0272faa7d}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D"}, "html": {"href": "https://bitbucket.org/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/21198da8539b599e3633017f5f5f8150d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsHB-6.png"}}, "nickname": "hugomatic", "type": "user", "account_id": "557058:869c02bb-b246-4cdc-9db3-0064e8add185"}, "inline": {"to": 166, "from": null, "path": "index.js"}, "updated_on": "2016-07-20T22:02:15.584421+00:00", "type": "pullrequest_comment", "id": 21288450}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288904.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:None..None?path=index.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288904"}}, "parent": {"id": 21288450, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288450.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288450"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "ok, will change this.", "markup": "markdown", "html": "<p>ok, will change this.</p>", "type": "rendered"}, "created_on": "2016-07-20T22:19:31.198969+00:00", "user": {"display_name": "Mohamd Ayman", "uuid": "{72e87935-5983-4f36-8505-0c88a6493930}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B72e87935-5983-4f36-8505-0c88a6493930%7D"}, "html": {"href": "https://bitbucket.org/%7B72e87935-5983-4f36-8505-0c88a6493930%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7/d5d765e0-f86b-4c0d-93ed-c67429f1f465/128"}}, "nickname": "Mohamd Ayman", "type": "user", "account_id": "557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7"}, "inline": {"to": null, "from": null, "path": "index.js"}, "updated_on": "2016-07-20T22:19:31.286487+00:00", "type": "pullrequest_comment", "id": 21288904}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288478.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:183348bc5050..e69da0c806b8?path=test%2Ftest_subscribe.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288478"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "Should you check for string instead of object? ", "markup": "markdown", "html": "<p>Should you check for string instead of object? </p>", "type": "rendered"}, "created_on": "2016-07-20T22:03:19.791272+00:00", "user": {"display_name": "Hugo Boyer", "uuid": "{3d87874e-7099-4981-b04f-57f0272faa7d}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D"}, "html": {"href": "https://bitbucket.org/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/21198da8539b599e3633017f5f5f8150d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsHB-6.png"}}, "nickname": "hugomatic", "type": "user", "account_id": "557058:869c02bb-b246-4cdc-9db3-0064e8add185"}, "inline": {"to": 33, "from": null, "path": "test/test_subscribe.js"}, "updated_on": "2016-07-20T22:03:19.794229+00:00", "type": "pullrequest_comment", "id": 21288478}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288833.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:None..None?path=test%2Ftest_subscribe.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288833"}}, "parent": {"id": 21288478, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288478.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288478"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "the return shouldn't be string, its json by default.", "markup": "markdown", "html": "<p>the return shouldn't be string, its json by default.</p>", "type": "rendered"}, "created_on": "2016-07-20T22:16:52.109515+00:00", "user": {"display_name": "Mohamd Ayman", "uuid": "{72e87935-5983-4f36-8505-0c88a6493930}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B72e87935-5983-4f36-8505-0c88a6493930%7D"}, "html": {"href": "https://bitbucket.org/%7B72e87935-5983-4f36-8505-0c88a6493930%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7/d5d765e0-f86b-4c0d-93ed-c67429f1f465/128"}}, "nickname": "Mohamd Ayman", "type": "user", "account_id": "557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7"}, "inline": {"to": null, "from": null, "path": "test/test_subscribe.js"}, "updated_on": "2016-07-20T22:16:52.150682+00:00", "type": "pullrequest_comment", "id": 21288833}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21292214.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:None..None?path=test%2Ftest_subscribe.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21292214"}}, "parent": {"id": 21288833, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288833.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288833"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "The test is 'toJson\" set to false'  (with a missing \"). So the expected result should be a string", "markup": "markdown", "html": "<p>The test is 'toJson\" set to false'  (with a missing \"). So the expected result should be a string</p>", "type": "rendered"}, "created_on": "2016-07-21T00:32:02.239612+00:00", "user": {"display_name": "Hugo Boyer", "uuid": "{3d87874e-7099-4981-b04f-57f0272faa7d}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D"}, "html": {"href": "https://bitbucket.org/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/21198da8539b599e3633017f5f5f8150d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsHB-6.png"}}, "nickname": "hugomatic", "type": "user", "account_id": "557058:869c02bb-b246-4cdc-9db3-0064e8add185"}, "inline": {"to": null, "from": null, "path": "test/test_subscribe.js"}, "updated_on": "2016-07-21T00:32:34.228330+00:00", "type": "pullrequest_comment", "id": 21292214}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21359024.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:None..None?path=test%2Ftest_subscribe.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21359024"}}, "parent": {"id": 21292214, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21292214.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21292214"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "sorry, you're right, it is a wrong check.", "markup": "markdown", "html": "<p>sorry, you're right, it is a wrong check.</p>", "type": "rendered"}, "created_on": "2016-07-22T06:47:17.847151+00:00", "user": {"display_name": "Mohamd Ayman", "uuid": "{72e87935-5983-4f36-8505-0c88a6493930}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B72e87935-5983-4f36-8505-0c88a6493930%7D"}, "html": {"href": "https://bitbucket.org/%7B72e87935-5983-4f36-8505-0c88a6493930%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7/d5d765e0-f86b-4c0d-93ed-c67429f1f465/128"}}, "nickname": "Mohamd Ayman", "type": "user", "account_id": "557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7"}, "inline": {"to": null, "from": null, "path": "test/test_subscribe.js"}, "updated_on": "2016-07-22T06:47:17.894005+00:00", "type": "pullrequest_comment", "id": 21359024}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288516.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:183348bc5050..e69da0c806b8?path=index.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288516"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "The code is more efficient if you check the 'toJson' option once at the begining, instead of each time there is a callback. Please move the check outside.\n", "markup": "markdown", "html": "<p>The code is more efficient if you check the 'toJson' option once at the begining, instead of each time there is a callback. Please move the check outside.</p>", "type": "rendered"}, "created_on": "2016-07-20T22:04:43.882272+00:00", "user": {"display_name": "Hugo Boyer", "uuid": "{3d87874e-7099-4981-b04f-57f0272faa7d}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D"}, "html": {"href": "https://bitbucket.org/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/21198da8539b599e3633017f5f5f8150d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsHB-6.png"}}, "nickname": "hugomatic", "type": "user", "account_id": "557058:869c02bb-b246-4cdc-9db3-0064e8add185"}, "inline": {"to": 163, "from": null, "path": "index.js"}, "updated_on": "2016-07-20T22:04:43.888376+00:00", "type": "pullrequest_comment", "id": 21288516}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288891.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:None..None?path=index.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288891"}}, "parent": {"id": 21288516, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288516.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288516"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "yes, it would, but it wasn't working for me, thats why i moved it inside.", "markup": "markdown", "html": "<p>yes, it would, but it wasn't working for me, thats why i moved it inside.</p>", "type": "rendered"}, "created_on": "2016-07-20T22:18:55.951538+00:00", "user": {"display_name": "Mohamd Ayman", "uuid": "{72e87935-5983-4f36-8505-0c88a6493930}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B72e87935-5983-4f36-8505-0c88a6493930%7D"}, "html": {"href": "https://bitbucket.org/%7B72e87935-5983-4f36-8505-0c88a6493930%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7/d5d765e0-f86b-4c0d-93ed-c67429f1f465/128"}}, "nickname": "Mohamd Ayman", "type": "user", "account_id": "557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7"}, "inline": {"to": null, "from": null, "path": "index.js"}, "updated_on": "2016-07-20T22:18:55.999951+00:00", "type": "pullrequest_comment", "id": 21288891}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21292398.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:None..None?path=index.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21292398"}}, "parent": {"id": 21288891, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21288891.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21288891"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "It wasn't working because the check the options had a bug. Putting the check inside the subscription only moved the bug. Try something like:\n\n\n```\n#!js\n\nGazebo.prototype.subscribe = function(type, topic, cb, options) {\n    var latch = false\n    var json = true\n    if(options){\n        if (typeof options['latch'] == \"boolean\") latch = options.latch\n        if (typeof options['toJson'] == \"boolean\") json = options.toJson\n    }\n    this.sim.subscribe(type, topic, function(err, data) {\n        if(err){\n            cb(err)\n            return\n        }\n        var result = data\n        if (json) {\n            // parse the string into a json msg\n            result = JSON.parse(data)\n        }\n        cb(err, result)\n    }, latch)\n}\n```\n", "markup": "markdown", "html": "<p>It wasn't working because the check the options had a bug. Putting the check inside the subscription only moved the bug. Try something like:</p>\n<div class=\"codehilite language-js\"><pre><span></span><span class=\"nx\">Gazebo</span><span class=\"p\">.</span><span class=\"nx\">prototype</span><span class=\"p\">.</span><span class=\"nx\">subscribe</span> <span class=\"o\">=</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">type</span><span class=\"p\">,</span> <span class=\"nx\">topic</span><span class=\"p\">,</span> <span class=\"nx\">cb</span><span class=\"p\">,</span> <span class=\"nx\">options</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">latch</span> <span class=\"o\">=</span> <span class=\"kc\">false</span>\n    <span class=\"kd\">var</span> <span class=\"nx\">json</span> <span class=\"o\">=</span> <span class=\"kc\">true</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">options</span><span class=\"p\">){</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">typeof</span> <span class=\"nx\">options</span><span class=\"p\">[</span><span class=\"s1\">&#39;latch&#39;</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;boolean&quot;</span><span class=\"p\">)</span> <span class=\"nx\">latch</span> <span class=\"o\">=</span> <span class=\"nx\">options</span><span class=\"p\">.</span><span class=\"nx\">latch</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">typeof</span> <span class=\"nx\">options</span><span class=\"p\">[</span><span class=\"s1\">&#39;toJson&#39;</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;boolean&quot;</span><span class=\"p\">)</span> <span class=\"nx\">json</span> <span class=\"o\">=</span> <span class=\"nx\">options</span><span class=\"p\">.</span><span class=\"nx\">toJson</span>\n    <span class=\"p\">}</span>\n    <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"nx\">sim</span><span class=\"p\">.</span><span class=\"nx\">subscribe</span><span class=\"p\">(</span><span class=\"nx\">type</span><span class=\"p\">,</span> <span class=\"nx\">topic</span><span class=\"p\">,</span> <span class=\"kd\">function</span><span class=\"p\">(</span><span class=\"nx\">err</span><span class=\"p\">,</span> <span class=\"nx\">data</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"k\">if</span><span class=\"p\">(</span><span class=\"nx\">err</span><span class=\"p\">){</span>\n            <span class=\"nx\">cb</span><span class=\"p\">(</span><span class=\"nx\">err</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span>\n        <span class=\"p\">}</span>\n        <span class=\"kd\">var</span> <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"nx\">data</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nx\">json</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n            <span class=\"c1\">// parse the string into a json msg</span>\n            <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">parse</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">)</span>\n        <span class=\"p\">}</span>\n        <span class=\"nx\">cb</span><span class=\"p\">(</span><span class=\"nx\">err</span><span class=\"p\">,</span> <span class=\"nx\">result</span><span class=\"p\">)</span>\n    <span class=\"p\">},</span> <span class=\"nx\">latch</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</pre></div>", "type": "rendered"}, "created_on": "2016-07-21T00:40:04.621762+00:00", "user": {"display_name": "Hugo Boyer", "uuid": "{3d87874e-7099-4981-b04f-57f0272faa7d}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D"}, "html": {"href": "https://bitbucket.org/%7B3d87874e-7099-4981-b04f-57f0272faa7d%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/21198da8539b599e3633017f5f5f8150d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsHB-6.png"}}, "nickname": "hugomatic", "type": "user", "account_id": "557058:869c02bb-b246-4cdc-9db3-0064e8add185"}, "inline": {"to": null, "from": null, "path": "index.js"}, "updated_on": "2016-07-21T00:40:04.627089+00:00", "type": "pullrequest_comment", "id": 21292398}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21357750.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:None..None?path=index.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21357750"}}, "parent": {"id": 21292398, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21292398.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21292398"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "ok i'll try this approach", "markup": "markdown", "html": "<p>ok i'll try this approach</p>", "type": "rendered"}, "created_on": "2016-07-22T06:01:08.435297+00:00", "user": {"display_name": "Mohamd Ayman", "uuid": "{72e87935-5983-4f36-8505-0c88a6493930}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B72e87935-5983-4f36-8505-0c88a6493930%7D"}, "html": {"href": "https://bitbucket.org/%7B72e87935-5983-4f36-8505-0c88a6493930%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7/d5d765e0-f86b-4c0d-93ed-c67429f1f465/128"}}, "nickname": "Mohamd Ayman", "type": "user", "account_id": "557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7"}, "inline": {"to": null, "from": null, "path": "index.js"}, "updated_on": "2016-07-22T06:01:08.474361+00:00", "type": "pullrequest_comment", "id": 21357750}, {"links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21358985.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/gazebojs/diff/mohamd_ayman/gazebojs:None..None?path=index.js"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21358985"}}, "parent": {"id": 21292398, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17/comments/21292398.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17/_/diff#comment-21292398"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 17, "links": {"self": {"href": "data/repositories/osrf/gazebojs/pullrequests/17.json"}, "html": {"href": "#!/osrf/gazebojs/pull-requests/17"}}, "title": "Fixing 'toJson' option in subscribe."}, "content": {"raw": "it works (y)", "markup": "markdown", "html": "<p>it works (y)</p>", "type": "rendered"}, "created_on": "2016-07-22T06:46:06.585451+00:00", "user": {"display_name": "Mohamd Ayman", "uuid": "{72e87935-5983-4f36-8505-0c88a6493930}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B72e87935-5983-4f36-8505-0c88a6493930%7D"}, "html": {"href": "https://bitbucket.org/%7B72e87935-5983-4f36-8505-0c88a6493930%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7/d5d765e0-f86b-4c0d-93ed-c67429f1f465/128"}}, "nickname": "Mohamd Ayman", "type": "user", "account_id": "557058:53a1879d-b572-46c9-97d3-8fa52b2ff8a7"}, "inline": {"to": null, "from": null, "path": "index.js"}, "updated_on": "2016-07-22T06:46:06.652074+00:00", "type": "pullrequest_comment", "id": 21358985}], "page": 1, "size": 14}